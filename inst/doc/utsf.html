<!DOCTYPE html>

<html>

<head>

<meta charset="utf-8" />
<meta name="generator" content="pandoc" />
<meta http-equiv="X-UA-Compatible" content="IE=EDGE" />

<meta name="viewport" content="width=device-width, initial-scale=1" />



<title>utsf</title>

<script>// Pandoc 2.9 adds attributes on both header and div. We remove the former (to
// be compatible with the behavior of Pandoc < 2.8).
document.addEventListener('DOMContentLoaded', function(e) {
  var hs = document.querySelectorAll("div.section[class*='level'] > :first-child");
  var i, h, a;
  for (i = 0; i < hs.length; i++) {
    h = hs[i];
    if (!/^h[1-6]$/i.test(h.tagName)) continue;  // it should be a header h1-h6
    a = h.attributes;
    while (a.length > 0) h.removeAttribute(a[0].name);
  }
});
</script>

<style type="text/css">
code{white-space: pre-wrap;}
span.smallcaps{font-variant: small-caps;}
span.underline{text-decoration: underline;}
div.column{display: inline-block; vertical-align: top; width: 50%;}
div.hanging-indent{margin-left: 1.5em; text-indent: -1.5em;}
ul.task-list{list-style: none;}
</style>



<style type="text/css">
code {
white-space: pre;
}
.sourceCode {
overflow: visible;
}
</style>
<style type="text/css" data-origin="pandoc">
pre > code.sourceCode { white-space: pre; position: relative; }
pre > code.sourceCode > span { line-height: 1.25; }
pre > code.sourceCode > span:empty { height: 1.2em; }
.sourceCode { overflow: visible; }
code.sourceCode > span { color: inherit; text-decoration: inherit; }
div.sourceCode { margin: 1em 0; }
pre.sourceCode { margin: 0; }
@media screen {
div.sourceCode { overflow: auto; }
}
@media print {
pre > code.sourceCode { white-space: pre-wrap; }
pre > code.sourceCode > span { display: inline-block; text-indent: -5em; padding-left: 5em; }
}
pre.numberSource code
{ counter-reset: source-line 0; }
pre.numberSource code > span
{ position: relative; left: -4em; counter-increment: source-line; }
pre.numberSource code > span > a:first-child::before
{ content: counter(source-line);
position: relative; left: -1em; text-align: right; vertical-align: baseline;
border: none; display: inline-block;
-webkit-touch-callout: none; -webkit-user-select: none;
-khtml-user-select: none; -moz-user-select: none;
-ms-user-select: none; user-select: none;
padding: 0 4px; width: 4em;
color: #aaaaaa;
}
pre.numberSource { margin-left: 3em; border-left: 1px solid #aaaaaa; padding-left: 4px; }
div.sourceCode
{ }
@media screen {
pre > code.sourceCode > span > a:first-child::before { text-decoration: underline; }
}
code span.al { color: #ff0000; font-weight: bold; } 
code span.an { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.at { color: #7d9029; } 
code span.bn { color: #40a070; } 
code span.bu { color: #008000; } 
code span.cf { color: #007020; font-weight: bold; } 
code span.ch { color: #4070a0; } 
code span.cn { color: #880000; } 
code span.co { color: #60a0b0; font-style: italic; } 
code span.cv { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.do { color: #ba2121; font-style: italic; } 
code span.dt { color: #902000; } 
code span.dv { color: #40a070; } 
code span.er { color: #ff0000; font-weight: bold; } 
code span.ex { } 
code span.fl { color: #40a070; } 
code span.fu { color: #06287e; } 
code span.im { color: #008000; font-weight: bold; } 
code span.in { color: #60a0b0; font-weight: bold; font-style: italic; } 
code span.kw { color: #007020; font-weight: bold; } 
code span.op { color: #666666; } 
code span.ot { color: #007020; } 
code span.pp { color: #bc7a00; } 
code span.sc { color: #4070a0; } 
code span.ss { color: #bb6688; } 
code span.st { color: #4070a0; } 
code span.va { color: #19177c; } 
code span.vs { color: #4070a0; } 
code span.wa { color: #60a0b0; font-weight: bold; font-style: italic; } 
</style>
<script>
// apply pandoc div.sourceCode style to pre.sourceCode instead
(function() {
  var sheets = document.styleSheets;
  for (var i = 0; i < sheets.length; i++) {
    if (sheets[i].ownerNode.dataset["origin"] !== "pandoc") continue;
    try { var rules = sheets[i].cssRules; } catch (e) { continue; }
    var j = 0;
    while (j < rules.length) {
      var rule = rules[j];
      // check if there is a div.sourceCode rule
      if (rule.type !== rule.STYLE_RULE || rule.selectorText !== "div.sourceCode") {
        j++;
        continue;
      }
      var style = rule.style.cssText;
      // check if color or background-color is set
      if (rule.style.color === '' && rule.style.backgroundColor === '') {
        j++;
        continue;
      }
      // replace div.sourceCode by a pre.sourceCode rule
      sheets[i].deleteRule(j);
      sheets[i].insertRule('pre.sourceCode{' + style + '}', j);
    }
  }
})();
</script>




<style type="text/css">body {
background-color: #fff;
margin: 1em auto;
max-width: 700px;
overflow: visible;
padding-left: 2em;
padding-right: 2em;
font-family: "Open Sans", "Helvetica Neue", Helvetica, Arial, sans-serif;
font-size: 14px;
line-height: 1.35;
}
#TOC {
clear: both;
margin: 0 0 10px 10px;
padding: 4px;
width: 400px;
border: 1px solid #CCCCCC;
border-radius: 5px;
background-color: #f6f6f6;
font-size: 13px;
line-height: 1.3;
}
#TOC .toctitle {
font-weight: bold;
font-size: 15px;
margin-left: 5px;
}
#TOC ul {
padding-left: 40px;
margin-left: -1.5em;
margin-top: 5px;
margin-bottom: 5px;
}
#TOC ul ul {
margin-left: -2em;
}
#TOC li {
line-height: 16px;
}
table {
margin: 1em auto;
border-width: 1px;
border-color: #DDDDDD;
border-style: outset;
border-collapse: collapse;
}
table th {
border-width: 2px;
padding: 5px;
border-style: inset;
}
table td {
border-width: 1px;
border-style: inset;
line-height: 18px;
padding: 5px 5px;
}
table, table th, table td {
border-left-style: none;
border-right-style: none;
}
table thead, table tr.even {
background-color: #f7f7f7;
}
p {
margin: 0.5em 0;
}
blockquote {
background-color: #f6f6f6;
padding: 0.25em 0.75em;
}
hr {
border-style: solid;
border: none;
border-top: 1px solid #777;
margin: 28px 0;
}
dl {
margin-left: 0;
}
dl dd {
margin-bottom: 13px;
margin-left: 13px;
}
dl dt {
font-weight: bold;
}
ul {
margin-top: 0;
}
ul li {
list-style: circle outside;
}
ul ul {
margin-bottom: 0;
}
pre, code {
background-color: #f7f7f7;
border-radius: 3px;
color: #333;
white-space: pre-wrap; 
}
pre {
border-radius: 3px;
margin: 5px 0px 10px 0px;
padding: 10px;
}
pre:not([class]) {
background-color: #f7f7f7;
}
code {
font-family: Consolas, Monaco, 'Courier New', monospace;
font-size: 85%;
}
p > code, li > code {
padding: 2px 0px;
}
div.figure {
text-align: center;
}
img {
background-color: #FFFFFF;
padding: 2px;
border: 1px solid #DDDDDD;
border-radius: 3px;
border: 1px solid #CCCCCC;
margin: 0 5px;
}
h1 {
margin-top: 0;
font-size: 35px;
line-height: 40px;
}
h2 {
border-bottom: 4px solid #f7f7f7;
padding-top: 10px;
padding-bottom: 2px;
font-size: 145%;
}
h3 {
border-bottom: 2px solid #f7f7f7;
padding-top: 10px;
font-size: 120%;
}
h4 {
border-bottom: 1px solid #f7f7f7;
margin-left: 8px;
font-size: 105%;
}
h5, h6 {
border-bottom: 1px solid #ccc;
font-size: 105%;
}
a {
color: #0033dd;
text-decoration: none;
}
a:hover {
color: #6666ff; }
a:visited {
color: #800080; }
a:visited:hover {
color: #BB00BB; }
a[href^="http:"] {
text-decoration: underline; }
a[href^="https:"] {
text-decoration: underline; }

code > span.kw { color: #555; font-weight: bold; } 
code > span.dt { color: #902000; } 
code > span.dv { color: #40a070; } 
code > span.bn { color: #d14; } 
code > span.fl { color: #d14; } 
code > span.ch { color: #d14; } 
code > span.st { color: #d14; } 
code > span.co { color: #888888; font-style: italic; } 
code > span.ot { color: #007020; } 
code > span.al { color: #ff0000; font-weight: bold; } 
code > span.fu { color: #900; font-weight: bold; } 
code > span.er { color: #a61717; background-color: #e3d2d2; } 
</style>




</head>

<body>




<h1 class="title toc-ignore">utsf</h1>



<div class="sourceCode" id="cb1"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb1-1"><a href="#cb1-1" tabindex="-1"></a><span class="fu">library</span>(utsf)</span></code></pre></div>
<p>In this document the <strong>utsf</strong> package is described. This
package offers a meta engine for applying different regression models
for univariate time series forecasting using an autoregressive
approach.</p>
<div id="univariate-time-series-forecasting-and-autoregressive-models" class="section level1">
<h1>Univariate time series forecasting and autoregressive models</h1>
<p>An univariate time series forecasting method is one in which the
future values of a series are predicted using only information from the
series. For example, the future values of a series can be forecast by
its mean historical value. An advantage of this type of prediction is
that, apart from the series being forecast, there is no need to collect
any further information in order to train the model used to predict the
future values of the series.</p>
<p>An autoregressive model is a kind of univariate time series
forecasting model in which a value of a time series is expressed as a
function of some of its past values. That is, an autoregressive model is
a regression model in which the independent variables are lagged values
(previous values) of the response variable. For example, given a time
series with the following historical values: <span class="math inline">\(t = \{1, 3, 6, 7, 9, 11, 16\}\)</span>, suppose
that we want to develop an autoregressive model in which a target “is
explained” by its first, second and fourth past values (in this context,
a previous value is also called a <em>lag</em>, so lag 1 is the value
immediately preceding a given value in the series). Given this series
and lags (1, 2 and 4), the training set would be:</p>
<table>
<thead>
<tr class="header">
<th>Lag 4</th>
<th>Lag 2</th>
<th>Lag 1</th>
<th>Target</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>6</td>
<td>7</td>
<td>9</td>
</tr>
<tr class="even">
<td>3</td>
<td>7</td>
<td>9</td>
<td>11</td>
</tr>
<tr class="odd">
<td>6</td>
<td>9</td>
<td>11</td>
<td>16</td>
</tr>
</tbody>
</table>
<p>In this model the next future value of the series is predicted as
<span class="math inline">\(f(Lag4, Lag2, Lag1)\)</span>, where <span class="math inline">\(f\)</span> is the regression function and <span class="math inline">\(Lag4\)</span>, <span class="math inline">\(Lag2\)</span> and <span class="math inline">\(Lag1\)</span> are the fourth, second and first
lagged values of the next future value. So, the next future value of
series <span class="math inline">\(t\)</span> is predicted as <span class="math inline">\(f(7, 11, 16)\)</span>, producing a value that will
be called <span class="math inline">\(F1\)</span>.</p>
<p>Suppose that the forecast horizon (the number of future values to be
forecast into the future) is greater than 1. In the case that the
regression function only predicts the next future value of the series, a
recursive approach can be applied to forecast all the future values of
the forecast horizon. Using a recursive approach, the regression
function is applied recursively until all horizons are forecast. For
instance, following the previous example, suppose that the forecast
horizon is 3. As we have explained, to forecast the next future value of
the series (horizon 1) the regression function is fed with the vector
<span class="math inline">\([7, 11, 16]\)</span>, producing <span class="math inline">\(F1\)</span>. To forecast horizon 2 the regression
function is fed with the vector <span class="math inline">\([9, 16,
F1]\)</span>. The forecast for horizon 1, <span class="math inline">\(F1\)</span>, is used as the first lag for horizon
2 because the actual value is unknown. Finally, to predict horizon 3 the
regression function is fed with the vector [<span class="math inline">\(11, F1, F2]\)</span>. This example of recursive
forecast is summarized in the following table:</p>
<table>
<thead>
<tr class="header">
<th>Horizon</th>
<th>Autoregressive values</th>
<th>Forecast</th>
</tr>
</thead>
<tbody>
<tr class="odd">
<td>1</td>
<td>7, 11, 16</td>
<td>F1</td>
</tr>
<tr class="even">
<td>2</td>
<td>9, 16, F1</td>
<td>F2</td>
</tr>
<tr class="odd">
<td>3</td>
<td>11, F1, F2</td>
<td>F3</td>
</tr>
</tbody>
</table>
<p>The recursive approach for forecasting several values into the future
is applied in classical statistical models such as ARIMA or exponential
smoothing.</p>
</div>
<div id="the-utsf-package" class="section level1">
<h1>The utsf package</h1>
<p>The <strong>utsf</strong> package makes it easy the use of classical
regression models for univariate time series forecasting employing the
autoregressive approach and the recursive prediction strategy explained
in the previous section. All the supported models are applied using an
uniform interface: the <code>forecast()</code> function. Let us see an
example in which a regression tree model is used to forecast the next
future values of a time series:</p>
<div class="sourceCode" id="cb2"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb2-1"><a href="#cb2-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">method =</span> <span class="st">&quot;rt&quot;</span>)</span></code></pre></div>
<p>In this example, an autoregressive tree model
(<code>method = &quot;rt&quot;</code>) is trained using the historical values of
the <code>AirPassengers</code> time series and a forecast for its 12
next future values (<code>h = 12</code>) is done. The
<code>forecast()</code> function returns an S3 object of class
<code>utsf</code> with information about the trained model and the
forecast. The information about the forecast is included in the
component <code>pred</code> as an object of class <code>ts</code> (a
time series):</p>
<div class="sourceCode" id="cb3"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb3-1"><a href="#cb3-1" tabindex="-1"></a>f<span class="sc">$</span>pred</span>
<span id="cb3-2"><a href="#cb3-2" tabindex="-1"></a><span class="co">#&gt;           Jan      Feb      Mar      Apr      May      Jun      Jul      Aug</span></span>
<span id="cb3-3"><a href="#cb3-3" tabindex="-1"></a><span class="co">#&gt; 1961 460.2980 428.4915 467.0304 496.9833 499.9819 554.7891 627.5849 628.0503</span></span>
<span id="cb3-4"><a href="#cb3-4" tabindex="-1"></a><span class="co">#&gt;           Sep      Oct      Nov      Dec</span></span>
<span id="cb3-5"><a href="#cb3-5" tabindex="-1"></a><span class="co">#&gt; 1961 533.2803 482.4221 448.7926 453.6920</span></span></code></pre></div>
<div class="sourceCode" id="cb4"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb4-1"><a href="#cb4-1" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb4-2"><a href="#cb4-2" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>The training set used to fit the model is built from the historical
values of the time series using the autoregressive approach explained in
the previous section. The <code>lags</code> parameter of the
<code>forecast()</code> function is used to specify the autoregressive
lags. In the example: <code>lags = 1:12</code>, so a target is a
function of its 12 previous values. Next, we consult the first targets
(and their associated features) with which the regression model has been
trained:</p>
<div class="sourceCode" id="cb5"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb5-1"><a href="#cb5-1" tabindex="-1"></a><span class="fu">head</span>(f<span class="sc">$</span>targets)  <span class="co"># first targets</span></span>
<span id="cb5-2"><a href="#cb5-2" tabindex="-1"></a><span class="co">#&gt; [1] -11.6666667  -0.9166667  13.4166667   6.6666667  -3.8333333  19.8333333</span></span></code></pre></div>
<div class="sourceCode" id="cb6"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb6-1"><a href="#cb6-1" tabindex="-1"></a><span class="fu">head</span>(f<span class="sc">$</span>features) <span class="co"># and its associated features</span></span>
<span id="cb6-2"><a href="#cb6-2" tabindex="-1"></a><span class="co">#&gt;         Lag12     Lag11     Lag10      Lag9       Lag8       Lag7       Lag6</span></span>
<span id="cb6-3"><a href="#cb6-3" tabindex="-1"></a><span class="co">#&gt; 1 -14.6666667 -8.666667  5.333333  2.333333  -5.666667   8.333333  21.333333</span></span>
<span id="cb6-4"><a href="#cb6-4" tabindex="-1"></a><span class="co">#&gt; 2  -8.9166667  5.083333  2.083333 -5.916667   8.083333  21.083333  21.083333</span></span>
<span id="cb6-5"><a href="#cb6-5" tabindex="-1"></a><span class="co">#&gt; 3   4.4166667  1.416667 -6.583333  7.416667  20.416667  20.416667   8.416667</span></span>
<span id="cb6-6"><a href="#cb6-6" tabindex="-1"></a><span class="co">#&gt; 4   0.6666667 -7.333333  6.666667 19.666667  19.666667   7.666667  -9.333333</span></span>
<span id="cb6-7"><a href="#cb6-7" tabindex="-1"></a><span class="co">#&gt; 5  -7.8333333  6.166667 19.166667 19.166667   7.166667  -9.833333 -24.833333</span></span>
<span id="cb6-8"><a href="#cb6-8" tabindex="-1"></a><span class="co">#&gt; 6   5.8333333 18.833333 18.833333  6.833333 -10.166667 -25.166667 -11.166667</span></span>
<span id="cb6-9"><a href="#cb6-9" tabindex="-1"></a><span class="co">#&gt;         Lag5       Lag4       Lag3       Lag2       Lag1</span></span>
<span id="cb6-10"><a href="#cb6-10" tabindex="-1"></a><span class="co">#&gt; 1  21.333333   9.333333  -7.666667 -22.666667  -8.666667</span></span>
<span id="cb6-11"><a href="#cb6-11" tabindex="-1"></a><span class="co">#&gt; 2   9.083333  -7.916667 -22.916667  -8.916667 -11.916667</span></span>
<span id="cb6-12"><a href="#cb6-12" tabindex="-1"></a><span class="co">#&gt; 3  -8.583333 -23.583333  -9.583333 -12.583333  -1.583333</span></span>
<span id="cb6-13"><a href="#cb6-13" tabindex="-1"></a><span class="co">#&gt; 4 -24.333333 -10.333333 -13.333333  -2.333333  12.666667</span></span>
<span id="cb6-14"><a href="#cb6-14" tabindex="-1"></a><span class="co">#&gt; 5 -10.833333 -13.833333  -2.833333  12.166667   6.166667</span></span>
<span id="cb6-15"><a href="#cb6-15" tabindex="-1"></a><span class="co">#&gt; 6 -14.166667  -3.166667  11.833333   5.833333  -4.166667</span></span></code></pre></div>
<p>Using the example of the previous section:</p>
<div class="sourceCode" id="cb7"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb7-1"><a href="#cb7-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">6</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">11</span>, <span class="dv">16</span>))</span>
<span id="cb7-2"><a href="#cb7-2" tabindex="-1"></a>out <span class="ot">&lt;-</span> <span class="fu">forecast</span>(t, <span class="at">h =</span> <span class="dv">3</span>, <span class="at">lags =</span> <span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">2</span>, <span class="dv">4</span>), <span class="at">preProcess =</span> <span class="cn">NULL</span>)</span>
<span id="cb7-3"><a href="#cb7-3" tabindex="-1"></a><span class="fu">cbind</span>(out<span class="sc">$</span>features, <span class="at">Target =</span> out<span class="sc">$</span>targets)</span>
<span id="cb7-4"><a href="#cb7-4" tabindex="-1"></a><span class="co">#&gt;   Lag4 Lag2 Lag1 Target</span></span>
<span id="cb7-5"><a href="#cb7-5" tabindex="-1"></a><span class="co">#&gt; 1    1    6    7      9</span></span>
<span id="cb7-6"><a href="#cb7-6" tabindex="-1"></a><span class="co">#&gt; 2    3    7    9     11</span></span>
<span id="cb7-7"><a href="#cb7-7" tabindex="-1"></a><span class="co">#&gt; 3    6    9   11     16</span></span></code></pre></div>
</div>
<div id="supported-models" class="section level1">
<h1>Supported models</h1>
<p>The <code>forecast()</code> function provides a common interface to
applying an autoregressive approach for time series forecasting using
different regression models. These models are implemented in several R
packages. Currently, the <code>forecast()</code> function is mainly
focused on regression tree models, supporting the following
approaches:</p>
<ul>
<li>k-nearest neighbors: In this case no model is trained and the
function <code>FNN::knn.reg()</code> is used, as regression function, to
recursively predict the future values of the time series.</li>
<li>Regression trees: The model is trained using the function
<code>rpart::rpart()</code> and its associated method
<code>rpart::predict.rpart()</code> is applied recursively for the
forecasts, i.e., as regression function.</li>
<li>Model trees: The model is trained with the function
<code>Cubist::cubist()</code> and its associated method
<code>Cubist::predict.cubist()</code> is used for predictions.</li>
<li>Bagging: The model is trained with the function
<code>ipred::bagging()</code> and its associated method
<code>ipred::predict.regbagg()</code> is used for forecasting.</li>
<li>Random forest: The model is trained with the function
<code>ranger::ranger()</code> and its associated method
<code>ranger::predict.ranger()</code> is used for predictions.</li>
</ul>
<p>The S3 object of class <code>utsf</code> returned by the
<code>forecast()</code> function contains a component with the trained
autoregressive model:</p>
<div class="sourceCode" id="cb8"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb8-1"><a href="#cb8-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(fdeaths, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">method =</span> <span class="st">&quot;rt&quot;</span>)</span>
<span id="cb8-2"><a href="#cb8-2" tabindex="-1"></a>f<span class="sc">$</span>model</span>
<span id="cb8-3"><a href="#cb8-3" tabindex="-1"></a><span class="co">#&gt; n= 60 </span></span>
<span id="cb8-4"><a href="#cb8-4" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-5"><a href="#cb8-5" tabindex="-1"></a><span class="co">#&gt; node), split, n, deviance, yval</span></span>
<span id="cb8-6"><a href="#cb8-6" tabindex="-1"></a><span class="co">#&gt;       * denotes terminal node</span></span>
<span id="cb8-7"><a href="#cb8-7" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb8-8"><a href="#cb8-8" tabindex="-1"></a><span class="co">#&gt; 1) root 60 1967124.00   -6.465278  </span></span>
<span id="cb8-9"><a href="#cb8-9" tabindex="-1"></a><span class="co">#&gt;   2) Lag12&lt; 73 38  212851.90 -124.414500  </span></span>
<span id="cb8-10"><a href="#cb8-10" tabindex="-1"></a><span class="co">#&gt;     4) Lag6&gt;=-66.45833 30   57355.07 -153.847200  </span></span>
<span id="cb8-11"><a href="#cb8-11" tabindex="-1"></a><span class="co">#&gt;       8) Lag12&lt; -170.7083 10   13293.09 -195.991700 *</span></span>
<span id="cb8-12"><a href="#cb8-12" tabindex="-1"></a><span class="co">#&gt;       9) Lag12&gt;=-170.7083 20   17419.67 -132.775000 *</span></span>
<span id="cb8-13"><a href="#cb8-13" tabindex="-1"></a><span class="co">#&gt;     5) Lag6&lt; -66.45833 8   32051.01  -14.041670 *</span></span>
<span id="cb8-14"><a href="#cb8-14" tabindex="-1"></a><span class="co">#&gt;   3) Lag12&gt;=73 22  312482.00  197.265200  </span></span>
<span id="cb8-15"><a href="#cb8-15" tabindex="-1"></a><span class="co">#&gt;     6) Lag5&gt;=-131.7917 7   24738.12  114.500000 *</span></span>
<span id="cb8-16"><a href="#cb8-16" tabindex="-1"></a><span class="co">#&gt;     7) Lag5&lt; -131.7917 15  217416.40  235.888900 *</span></span></code></pre></div>
<p>In this case, the model is the result of training a regression tree
using the function <code>rpart::rpart()</code> with the training set
consisting of the features <code>f$features</code> and targets
<code>f$targets</code>. Once the model is trained, the
<code>rpart::predict.rpart()</code> function is used recursively to
forecast the future values of the time series.</p>
</div>
<div id="using-your-own-models" class="section level1">
<h1>Using your own models</h1>
<p>One interesting feature of the <strong>utsf</strong> package is that
you can use the <code>forecast()</code> function to apply your own
regression models for time series forecasting in an autoregressive way.
Thus, your regression models can benefit from the features implemented
in the <code>forecast()</code> function, such as preprocessing,
parameter tuning, the building of the training set, the implementation
of recursive forecasts or the estimation of the forecast accuracy of the
model.</p>
<p>To apply your own regression model with the <code>forecast()</code>
function you have to use the <code>method</code> parameter, providing a
function that is able to train your model. This function should return
an object with the trained regression model. Also, it must have at least
two input parameters:</p>
<ul>
<li><code>X</code>: it is a data frame with the features of the training
examples. This data frame is built from the time series taking into
account the autoregressive lags as explained in a previous section. This
is the same object as the <code>features</code> component of the object
returned by the <code>forecast()</code> function.</li>
<li><code>y</code>: a vector with the targets of the training examples.
It is built as explained in a previous section. It is the same object as
the <code>targets</code> component of the object returned by the
<code>forecast()</code> function.</li>
</ul>
<p>Furthermore, if the function that trains the model (the function
provided in the <code>method</code> parameter) returns a model of class
<code>model_class</code>, a method with the signature
<code>predict.model_class(object, new_value)</code> should be
implemented. This method uses your model to predict a new value, that
is, it is the regression function associated with the model.</p>
<p>Let us see an example in which the <code>forecast()</code> function
is used to forecast a time series using the k-nearest neighbors
regression model implemented in the package FNN:</p>
<div class="sourceCode" id="cb9"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb9-1"><a href="#cb9-1" tabindex="-1"></a><span class="co"># Function to train the regression model</span></span>
<span id="cb9-2"><a href="#cb9-2" tabindex="-1"></a>my_knn_model <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">k =</span> <span class="dv">3</span>) {</span>
<span id="cb9-3"><a href="#cb9-3" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">X =</span> X, <span class="at">y =</span> y, <span class="at">k =</span> k), <span class="at">class =</span> <span class="st">&quot;my_knn&quot;</span>)</span>
<span id="cb9-4"><a href="#cb9-4" tabindex="-1"></a>}</span>
<span id="cb9-5"><a href="#cb9-5" tabindex="-1"></a></span>
<span id="cb9-6"><a href="#cb9-6" tabindex="-1"></a><span class="co"># Function to predict a new example</span></span>
<span id="cb9-7"><a href="#cb9-7" tabindex="-1"></a>predict.my_knn <span class="ot">&lt;-</span> <span class="cf">function</span>(object, new_value) {</span>
<span id="cb9-8"><a href="#cb9-8" tabindex="-1"></a>  FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> object<span class="sc">$</span>X, <span class="at">test =</span> new_value, </span>
<span id="cb9-9"><a href="#cb9-9" tabindex="-1"></a>               <span class="at">y =</span> object<span class="sc">$</span>y, <span class="at">k =</span> object<span class="sc">$</span>k)<span class="sc">$</span>pred</span>
<span id="cb9-10"><a href="#cb9-10" tabindex="-1"></a>}</span>
<span id="cb9-11"><a href="#cb9-11" tabindex="-1"></a></span>
<span id="cb9-12"><a href="#cb9-12" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">method =</span> my_knn_model)</span>
<span id="cb9-13"><a href="#cb9-13" tabindex="-1"></a><span class="fu">print</span>(f<span class="sc">$</span>pred)</span>
<span id="cb9-14"><a href="#cb9-14" tabindex="-1"></a><span class="co">#&gt;           Jan      Feb      Mar      Apr      May      Jun      Jul      Aug</span></span>
<span id="cb9-15"><a href="#cb9-15" tabindex="-1"></a><span class="co">#&gt; 1961 455.9167 434.3264 480.7703 490.1678 506.1262 568.0534 640.6689 640.8636</span></span>
<span id="cb9-16"><a href="#cb9-16" tabindex="-1"></a><span class="co">#&gt;           Sep      Oct      Nov      Dec</span></span>
<span id="cb9-17"><a href="#cb9-17" tabindex="-1"></a><span class="co">#&gt; 1961 549.5467 495.4255 441.6554 476.7934</span></span></code></pre></div>
<div class="sourceCode" id="cb10"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb10-1"><a href="#cb10-1" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>The <code>new_value</code> parameter of the <code>predict</code>
method receives a data frame with the same structure as the
<code>X</code> parameter of the function for building the model. The
<code>new_value</code> data frame only has one row, with the features of
the example to be predicted.</p>
<p>The k-nearest neighbors algorithm is so simple that it can be easily
implemented without using functionality of any R package:</p>
<div class="sourceCode" id="cb11"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb11-1"><a href="#cb11-1" tabindex="-1"></a><span class="co"># Function to train the regression model</span></span>
<span id="cb11-2"><a href="#cb11-2" tabindex="-1"></a>my_knn_model2 <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">k =</span> <span class="dv">3</span>) {</span>
<span id="cb11-3"><a href="#cb11-3" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">X =</span> X, <span class="at">y =</span> y, <span class="at">k =</span> k), <span class="at">class =</span> <span class="st">&quot;my_knn2&quot;</span>)</span>
<span id="cb11-4"><a href="#cb11-4" tabindex="-1"></a>}</span>
<span id="cb11-5"><a href="#cb11-5" tabindex="-1"></a></span>
<span id="cb11-6"><a href="#cb11-6" tabindex="-1"></a><span class="co"># Function to predict a new example</span></span>
<span id="cb11-7"><a href="#cb11-7" tabindex="-1"></a>predict.my_knn2 <span class="ot">&lt;-</span> <span class="cf">function</span>(object, new_value) {</span>
<span id="cb11-8"><a href="#cb11-8" tabindex="-1"></a>  distances <span class="ot">&lt;-</span> <span class="fu">sapply</span>(<span class="dv">1</span><span class="sc">:</span><span class="fu">nrow</span>(object<span class="sc">$</span>X), <span class="cf">function</span>(i) <span class="fu">sum</span>((object<span class="sc">$</span>X[i, ] <span class="sc">-</span> new_value)<span class="sc">^</span><span class="dv">2</span>))</span>
<span id="cb11-9"><a href="#cb11-9" tabindex="-1"></a>  k_nearest <span class="ot">&lt;-</span> <span class="fu">order</span>(distances)[<span class="dv">1</span><span class="sc">:</span>object<span class="sc">$</span>k]</span>
<span id="cb11-10"><a href="#cb11-10" tabindex="-1"></a>  <span class="fu">mean</span>(object<span class="sc">$</span>y[k_nearest])</span>
<span id="cb11-11"><a href="#cb11-11" tabindex="-1"></a>}</span>
<span id="cb11-12"><a href="#cb11-12" tabindex="-1"></a></span>
<span id="cb11-13"><a href="#cb11-13" tabindex="-1"></a>f2 <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">method =</span> my_knn_model2)</span>
<span id="cb11-14"><a href="#cb11-14" tabindex="-1"></a><span class="fu">print</span>(f2<span class="sc">$</span>pred)</span>
<span id="cb11-15"><a href="#cb11-15" tabindex="-1"></a><span class="co">#&gt;           Jan      Feb      Mar      Apr      May      Jun      Jul      Aug</span></span>
<span id="cb11-16"><a href="#cb11-16" tabindex="-1"></a><span class="co">#&gt; 1961 455.9167 434.3264 480.7703 490.1678 506.1262 568.0534 640.6689 640.8636</span></span>
<span id="cb11-17"><a href="#cb11-17" tabindex="-1"></a><span class="co">#&gt;           Sep      Oct      Nov      Dec</span></span>
<span id="cb11-18"><a href="#cb11-18" tabindex="-1"></a><span class="co">#&gt; 1961 549.5467 495.4255 441.6554 476.7934</span></span></code></pre></div>
<p>Finally, we are going to forecast an artificial time series with a
trend by means of a simple linear regression model.</p>
<div class="sourceCode" id="cb12"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb12-1"><a href="#cb12-1" tabindex="-1"></a><span class="fu">set.seed</span>(<span class="dv">7</span>)</span>
<span id="cb12-2"><a href="#cb12-2" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">15</span> <span class="sc">+</span> <span class="fu">rnorm</span>(<span class="dv">15</span>, <span class="at">sd =</span> <span class="fl">0.5</span>) <span class="co"># time series</span></span>
<span id="cb12-3"><a href="#cb12-3" tabindex="-1"></a>my_lm <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y) <span class="fu">lm</span>(y <span class="sc">~</span> ., <span class="at">data =</span> <span class="fu">data.frame</span>(<span class="fu">cbind</span>(X, <span class="at">y =</span> y)))</span>
<span id="cb12-4"><a href="#cb12-4" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(t, <span class="at">h =</span> <span class="dv">5</span>, <span class="at">lags =</span> <span class="dv">1</span>, <span class="at">method =</span> my_lm, <span class="at">preProcess =</span> <span class="cn">NULL</span>)</span>
<span id="cb12-5"><a href="#cb12-5" tabindex="-1"></a><span class="fu">library</span>(ggplot2)</span>
<span id="cb12-6"><a href="#cb12-6" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>In this case, we rely on the <code>predict.lm</code> method to
predict new values. Let us see, the model:</p>
<div class="sourceCode" id="cb13"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb13-1"><a href="#cb13-1" tabindex="-1"></a>f<span class="sc">$</span>model</span>
<span id="cb13-2"><a href="#cb13-2" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-3"><a href="#cb13-3" tabindex="-1"></a><span class="co">#&gt; Call:</span></span>
<span id="cb13-4"><a href="#cb13-4" tabindex="-1"></a><span class="co">#&gt; lm(formula = y ~ ., data = data.frame(cbind(X, y = y)))</span></span>
<span id="cb13-5"><a href="#cb13-5" tabindex="-1"></a><span class="co">#&gt; </span></span>
<span id="cb13-6"><a href="#cb13-6" tabindex="-1"></a><span class="co">#&gt; Coefficients:</span></span>
<span id="cb13-7"><a href="#cb13-7" tabindex="-1"></a><span class="co">#&gt; (Intercept)         Lag1  </span></span>
<span id="cb13-8"><a href="#cb13-8" tabindex="-1"></a><span class="co">#&gt;      0.7914       1.0251</span></span></code></pre></div>
<p>The forecast of a future value is computed as <span class="math inline">\(0.7914 + 1.0251Lag1\)</span>, where
<code>Lag1</code> is the previous value to the future value being
forecast.</p>
</div>
<div id="setting-the-parameters-of-the-regression-models" class="section level1">
<h1>Setting the parameters of the regression models</h1>
<p>Normally, a regression model can be adjusted using different
parameters. By default, the models supported by the
<code>forecast()</code> function are set using some specific parameters,
usually the default values of the functions used to train the models
(these functions are listed in a previous section). However, the user
can set the parameters used to train the regression models with the
<code>param</code> argument of the <code>forecast()</code> function. The
<code>param</code> argument must be a list with the names and values of
the parameters to be set. Let us see an example:</p>
<div class="sourceCode" id="cb14"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb14-1"><a href="#cb14-1" tabindex="-1"></a><span class="co"># A bagging model set with default parameters</span></span>
<span id="cb14-2"><a href="#cb14-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, <span class="at">method =</span> <span class="st">&quot;bagging&quot;</span>)</span>
<span id="cb14-3"><a href="#cb14-3" tabindex="-1"></a><span class="fu">length</span>(f<span class="sc">$</span>model<span class="sc">$</span>mtrees) <span class="co"># number of regression trees (25 by default)</span></span>
<span id="cb14-4"><a href="#cb14-4" tabindex="-1"></a><span class="co">#&gt; [1] 25</span></span></code></pre></div>
<div class="sourceCode" id="cb15"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb15-1"><a href="#cb15-1" tabindex="-1"></a><span class="co"># A bagging model set with 3 regression tress</span></span>
<span id="cb15-2"><a href="#cb15-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, </span>
<span id="cb15-3"><a href="#cb15-3" tabindex="-1"></a>              <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>, </span>
<span id="cb15-4"><a href="#cb15-4" tabindex="-1"></a>              <span class="at">method =</span> <span class="st">&quot;bagging&quot;</span>, </span>
<span id="cb15-5"><a href="#cb15-5" tabindex="-1"></a>              <span class="at">param =</span> <span class="fu">list</span>(<span class="at">nbagg =</span> <span class="dv">3</span>)</span>
<span id="cb15-6"><a href="#cb15-6" tabindex="-1"></a>)</span>
<span id="cb15-7"><a href="#cb15-7" tabindex="-1"></a><span class="fu">length</span>(f<span class="sc">$</span>model<span class="sc">$</span>mtrees) <span class="co"># number of regression trees</span></span>
<span id="cb15-8"><a href="#cb15-8" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<p>In the previous example, two bagging models (using regression trees)
are trained with the <code>forecast()</code> function. In the first
model the number of trees is 25, the default value of the function
<code>ipred::ipredbagg()</code> used to train the model. In the second
model the number of trees is set to 3. Of course, in order to set some
specific parameters the user must consult the arguments of the function
used internally by the <code>forecast()</code> function to train the
model. In the example, <code>ipred::ipredbagg()</code>.</p>
<p>In the following example the user sets the parameters of a regression
model implemented by himself/herself:</p>
<div class="sourceCode" id="cb16"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb16-1"><a href="#cb16-1" tabindex="-1"></a><span class="co"># Function to train the model</span></span>
<span id="cb16-2"><a href="#cb16-2" tabindex="-1"></a>my_knn_model <span class="ot">&lt;-</span> <span class="cf">function</span>(X, y, <span class="at">k =</span> <span class="dv">3</span>) {</span>
<span id="cb16-3"><a href="#cb16-3" tabindex="-1"></a>  <span class="fu">structure</span>(<span class="fu">list</span>(<span class="at">X =</span> X, <span class="at">y =</span> y, <span class="at">k =</span> k), <span class="at">class =</span> <span class="st">&quot;my_knn&quot;</span>)</span>
<span id="cb16-4"><a href="#cb16-4" tabindex="-1"></a>}</span>
<span id="cb16-5"><a href="#cb16-5" tabindex="-1"></a></span>
<span id="cb16-6"><a href="#cb16-6" tabindex="-1"></a><span class="co"># Regression function for object of class my_knn</span></span>
<span id="cb16-7"><a href="#cb16-7" tabindex="-1"></a>predict.my_knn <span class="ot">&lt;-</span> <span class="cf">function</span>(object, new_value) {</span>
<span id="cb16-8"><a href="#cb16-8" tabindex="-1"></a>  FNN<span class="sc">::</span><span class="fu">knn.reg</span>(<span class="at">train =</span> object<span class="sc">$</span>X, <span class="at">test =</span> new_value, </span>
<span id="cb16-9"><a href="#cb16-9" tabindex="-1"></a>               <span class="at">y =</span> object<span class="sc">$</span>y, <span class="at">k =</span> object<span class="sc">$</span>k)<span class="sc">$</span>pred</span>
<span id="cb16-10"><a href="#cb16-10" tabindex="-1"></a>}</span>
<span id="cb16-11"><a href="#cb16-11" tabindex="-1"></a></span>
<span id="cb16-12"><a href="#cb16-12" tabindex="-1"></a><span class="co"># The model is trained with default parameters (k = 3)</span></span>
<span id="cb16-13"><a href="#cb16-13" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">12</span>,  <span class="at">method =</span> my_knn_model)</span>
<span id="cb16-14"><a href="#cb16-14" tabindex="-1"></a><span class="fu">print</span>(f<span class="sc">$</span>model<span class="sc">$</span>k)</span>
<span id="cb16-15"><a href="#cb16-15" tabindex="-1"></a><span class="co">#&gt; [1] 3</span></span></code></pre></div>
<div class="sourceCode" id="cb17"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb17-1"><a href="#cb17-1" tabindex="-1"></a><span class="co"># The model is trained with k = 5</span></span>
<span id="cb17-2"><a href="#cb17-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(AirPassengers, <span class="at">h =</span> <span class="dv">12</span>, </span>
<span id="cb17-3"><a href="#cb17-3" tabindex="-1"></a>              <span class="at">method =</span> my_knn_model, <span class="at">param =</span> <span class="fu">list</span>(<span class="at">k =</span> <span class="dv">5</span>))</span>
<span id="cb17-4"><a href="#cb17-4" tabindex="-1"></a><span class="fu">print</span>(f<span class="sc">$</span>model<span class="sc">$</span>k)</span>
<span id="cb17-5"><a href="#cb17-5" tabindex="-1"></a><span class="co">#&gt; [1] 5</span></span></code></pre></div>
</div>
<div id="estimating-forecast-accuracy" class="section level1">
<h1>Estimating forecast accuracy</h1>
<p>This section explains how to estimate the forecast accuracy of a
regression model predicting a time series with the <strong>utsf</strong>
package. Let us see an example:</p>
<div class="sourceCode" id="cb18"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb18-1"><a href="#cb18-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(UKgas, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>, <span class="at">efa =</span> <span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb18-2"><a href="#cb18-2" tabindex="-1"></a>f<span class="sc">$</span>efa </span>
<span id="cb18-3"><a href="#cb18-3" tabindex="-1"></a><span class="co">#&gt;       MAE      MAPE     sMAPE      RMSE </span></span>
<span id="cb18-4"><a href="#cb18-4" tabindex="-1"></a><span class="co">#&gt; 49.304102  7.226569  7.499436 53.862046</span></span></code></pre></div>
<p>To assess the forecast accuracy of a regression model you can use the
<code>forecast()</code> function to specify the regression task, using
the <code>efa</code> parameter to choose how the forecast accuracy is
estimated. In this case a k- nearest neighbors model is used
(<code>model = &quot;knn&quot;</code>) with the autoregressive lags 1 to 4 and an
estimation of its forecast accuracy on the <code>UKgas</code> time
series for a forecast horizon of 4 (<code>h = 4</code>) is obtained
using a fixed origin strategy. The result of this estimation can be
found in the <code>efa</code> component of the object returned by the
<code>forecast()</code> function. It is a vector with estimates of
forecast errors according to different forecast accuracy measures. For
instance, in the example, the estimated mean absolute error (MAE) for
horizon 4 is 49.3 approximately. Currently, the following forecasting
accuracy measures are computed:</p>
<ul>
<li>MAE: mean absolute error</li>
<li>MAPE: mean absolute percentage error</li>
<li>sMAPE: symmetric MAPE</li>
<li>RMSE: root mean squared error</li>
</ul>
<p>Next, we describe how the forecasting accuracy measures are computed
for a forecasting horizon <span class="math inline">\(h\)</span> (<span class="math inline">\(y_t\)</span> and <span class="math inline">\(\hat{y}_t\)</span> are the actual future value and
its forecast for horizon <span class="math inline">\(t\)</span>
respectively):</p>
<p><span class="math display">\[
MAE = \frac{1}{h}\sum_{t=1}^{h} |y_t-\hat{y}_t|
\]</span></p>
<p><span class="math display">\[
MAPE = \frac{1}{h}\sum_{t=1}^{h} 100\frac{|y_t-\hat{y}_t|}{y_t}
\]</span> <span class="math display">\[
sMAPE = \frac{1}{h}\sum_{t=1}^{h}
200\frac{\left|y_{t}-\hat{y}_{t}\right|}{|y_t|+|\hat{y}_t|}
\]</span></p>
<p><span class="math display">\[
RMSE = \sqrt{\frac{1}{h}\sum_{t=1}^{h} (y_t-\hat{y}_t)^2}
\]</span></p>
<p>The <code>efa</code> parameter can be:</p>
<ul>
<li><code>&quot;fixed&quot;</code>: In that case a fixed origin evaluation is
followed to estimate the forecast error. The test set is formed by the
last <code>h</code> observations of the time series and the training set
is formed by its previous values.</li>
<li><code>&quot;rolling&quot;</code>: The rolling origin strategy is applied.
First, rolling origin uses a test set formed by the last <code>h</code>
historical values and a training set consisting of the previous
historical values. This procedure is repeated <span class="math inline">\(h -1\)</span> times, moving the origin of the test
set one value ahead each time. This way, <code>h</code> one step ahead
predictions can be assessed, <span class="math inline">\(h - 1\)</span>
two steps ahead predictions, and so on. This is a great contrast with
the fixed origin evaluation that, for a validation set of size
<code>h</code>, is only able to assess one prediction for each one of
the <code>h</code> horizons. However, rolling origin evaluation is more
computationally intensive than fixed origin evaluation.</li>
</ul>
</div>
<div id="parameter-tuning" class="section level1">
<h1>Parameter tuning</h1>
<p>Another useful feature of the <strong>utsf</strong> package is
parameter tuning. The <code>forecast()</code> function allows to
estimate the forecast accuracy of a model using different combinations
of parameters. Furthermore, the best combination of parameters is used
to train the model with all the historical values of the series and
forecast the future values of the series. Let us see an example:</p>
<div class="sourceCode" id="cb19"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb19-1"><a href="#cb19-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(UKgas, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;knn&quot;</span>, </span>
<span id="cb19-2"><a href="#cb19-2" tabindex="-1"></a>              <span class="at">tuneGrid =</span> <span class="fu">expand.grid</span>(<span class="at">k =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">7</span>), <span class="at">efa =</span> <span class="st">&quot;fixed&quot;</span>)</span>
<span id="cb19-3"><a href="#cb19-3" tabindex="-1"></a>f<span class="sc">$</span>tuneGrid </span>
<span id="cb19-4"><a href="#cb19-4" tabindex="-1"></a><span class="co">#&gt;   k      MAE     MAPE    sMAPE     RMSE</span></span>
<span id="cb19-5"><a href="#cb19-5" tabindex="-1"></a><span class="co">#&gt; 1 1 26.39307 3.781212 3.725138 34.51027</span></span>
<span id="cb19-6"><a href="#cb19-6" tabindex="-1"></a><span class="co">#&gt; 2 2 49.04570 7.209276 7.447296 52.11319</span></span>
<span id="cb19-7"><a href="#cb19-7" tabindex="-1"></a><span class="co">#&gt; 3 3 49.30410 7.226569 7.499436 53.86205</span></span>
<span id="cb19-8"><a href="#cb19-8" tabindex="-1"></a><span class="co">#&gt; 4 4 46.82356 6.604359 6.825456 53.25469</span></span>
<span id="cb19-9"><a href="#cb19-9" tabindex="-1"></a><span class="co">#&gt; 5 5 53.05555 7.267617 7.538089 62.05870</span></span>
<span id="cb19-10"><a href="#cb19-10" tabindex="-1"></a><span class="co">#&gt; 6 6 55.16359 7.104669 7.347932 66.33756</span></span>
<span id="cb19-11"><a href="#cb19-11" tabindex="-1"></a><span class="co">#&gt; 7 7 48.01931 5.719260 5.906827 62.99989</span></span></code></pre></div>
<p>In this example, the <code>tuneGrid</code> parameter is used to
specify (using a data frame) the set of parameters to assess. The
forecast accuracy of the model using the different combinations of
parameters is estimated as explained in the previous section using the
last observations of the time series as validation set. The
<code>efa</code> parameter is used to specify whether fixed or rolling
origin evaluation is applied. The <code>tuneGrid</code> component of the
object returned by the <code>forecast()</code> function contains the
result of the estimation. In this case, the k-nearest neighbors method
using <span class="math inline">\(k=1\)</span> obtains the best results
for all the forecast accuracy measures. The best combination of
parameters according to RMSE is used to forecast the time series:</p>
<div class="sourceCode" id="cb20"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb20-1"><a href="#cb20-1" tabindex="-1"></a>f<span class="sc">$</span>param</span>
<span id="cb20-2"><a href="#cb20-2" tabindex="-1"></a><span class="co">#&gt; $k</span></span>
<span id="cb20-3"><a href="#cb20-3" tabindex="-1"></a><span class="co">#&gt; [1] 1</span></span></code></pre></div>
<div class="sourceCode" id="cb21"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb21-1"><a href="#cb21-1" tabindex="-1"></a>f<span class="sc">$</span>pred </span>
<span id="cb21-2"><a href="#cb21-2" tabindex="-1"></a><span class="co">#&gt;           Qtr1      Qtr2      Qtr3      Qtr4</span></span>
<span id="cb21-3"><a href="#cb21-3" tabindex="-1"></a><span class="co">#&gt; 1987 1217.9250  661.4063  388.1828  817.3785</span></span></code></pre></div>
<p>Let us plot the values of <span class="math inline">\(k\)</span>
against their estimated accuracy using RMSE:</p>
<div class="sourceCode" id="cb22"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb22-1"><a href="#cb22-1" tabindex="-1"></a><span class="fu">plot</span>(f<span class="sc">$</span>tuneGrid<span class="sc">$</span>k, f<span class="sc">$</span>tuneGrid<span class="sc">$</span>RMSE, <span class="at">type =</span> <span class="st">&quot;o&quot;</span>, <span class="at">pch =</span> <span class="dv">19</span>, <span class="at">xlab =</span> <span class="st">&quot;k (number of nearest neighbors)&quot;</span>, <span class="at">ylab =</span> <span class="st">&quot;RMSE&quot;</span>, <span class="at">main =</span> <span class="st">&quot;Estimated accuracy&quot;</span>)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAAAw1BMVEUAAAAAADoAAGYAOjoAOmYAOpAAZpAAZrY6AAA6ADo6AGY6OgA6Ojo6OmY6OpA6ZpA6ZrY6kLY6kNtmAABmADpmOgBmkJBmkLZmkNtmtrZmtttmtv+QOgCQZgCQZjqQkGaQkLaQtpCQttuQtv+Q2/+2ZgC2Zjq2ZpC2kDq2kGa2tma225C227a229u22/+2/7a2/9u2///bkDrbkGbbkJDbtmbbtpDb27bb29vb2//b////tmb/25D/27b//7b//9v///8oG3YQAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAOq0lEQVR4nO1d63obtxE9kqVKre06EeO0MZW4cUX3ardmmqTVSuK+/1N1cdsLCYAAdrAzsnx+6KMWg5mDQ9xIzmLRfkEU4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB2gcrSFw/ntpGD3l0/t7nr/6gGUmQcbnHqvLwZQOQoJdP/6NEUgbebB5y9QYgtDZp+TQOOW/PQcOHn1UTWww+m/VQ96WOHil+c4edP+dImzG2X2y+uu9OWNM+u62vuu3lda4d37zurdSKDeuMPPnf9nb6YvjWkX5UqxOfnxNU4/+ip13flC/dsA6+PtAoU4ChOBbHfqrkwFMnhuyxRFhZMbJ5A1OevKumb0TlrbHmts9YRSYvRyKpDpy95Klmpa5yQUyGGtSF7ctj8PtHdOoCt1FW+U9ZW6+pvb9u5yaN1GvenmQte0i1vVoWwrxsZd2de39ytVNHq5J9D5x/a//krd/2tteJHQrioCdQzOPtjrE4G66cn8NZw7/Pq3rj9dWDPTOPMO980dvc0T43b76oPnZS/QOljJjLG0EVZHIDM8nv3hdl+gC/fGGYF2P5gajn531Q0JN1EM42AwHq2J4+Vxbw66CVZy78CxnQe1QKO3+v61aeefowIpHc/+9OuqF6hBL5AbAJvREHPGTjxztR8nxtRIbwXyV1I2a9tbjwKzlbGYrmLt/dvnZsWPCGTa8rAa9yDX690b3gs0Mo72oIlA/kpaLNfHjgHzZBmwPVgTdt/3c4lfIDMLjCbp8by5PwcdGLfNy3eTl6bJDUYCBSqp4udpI6zGHHT6SS8Yapx1HDTVYA86v72/1nOQadFG7ZLu9TRuVrENRj2oN+7KvrpVw2c9fqlXRmUx6UG+SmaySxphdQRq3w/bj2ayUTyYg9wk3Yz3QeNty3gOcsaubPqyn+Knc5CvkrqeuEOvI5DetOLlR8WlE+vsQ3gVO3u3dVvos4/t/Q9dK9UOvCv862W3752uYtbYbor/qK8PL++6peHVPw9WMV+lBkmbIEqBHhcSN0HtUxWomx5TPwOjKhGZ0DNd2hT9ZAU6+TrVGBWJfBYANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QCxu0eDGgI9rFRKhMkFI3BXE0cVOFJcYNhagbYq9/FhFUg/ynFXEcf7SLy0xLA1AllptoEU0Rx39ZAwiqKFRYatEejuUgvUBAZZjrt64BToSw+KwCTpXrRuup7prhqcPjGJIkWFhgYqe+2mW8hCGX6Z7mpAy2L7T7gbha6XG7K4KyCwzyAgkf/qHMO4l+z9Vx144/svJrvMIrCxN3UFb5TJc0eM8Hg6LAmZHtbNYaD1+e2N0I1iNPa+RFHjIsPWrl0bfY+DvGX+6OieztvHrIdqGRxUv9ld6wVM2kYxbfLTS79RKMm+zTFUUL1nK7AHZXw2d0tJeo0cIg+r00+6CzWhWTrL3WzYzpARtLJA/d39wXutMt3NQ8HOorpAC7uLxyrZedWdgxZ3F49VtDWtuYot7y4ea87ePblaof+F3B0JNuOzTXK90gDLuDsSa8Znv+SKxREWcVcvVHLteWFqu6sXKrn2vDC13dWLlFx9ZhznZfHvg+YGSq4/N1Bdd/XiJDuYHamqu3phkj3MD1XTXb0oyS4IYlV0Vy9Isg+KYPXc1YuR7IQkWjV39UIke6EJV8tdvQjJbnLiicgPIoqQ7MYYjn7GCX0d38rID6IKkOzHGOoGmx8sjgjEnN1B5j/ZkTFMF4g3P4jOfbInY/hIehCh92RXxjBVIN78IErnyb6MYZpALW9+EKnvZGfGMFkgsrjcrpO9GcO5Ai3wfRCx52R3xrA/TT22Cay7UTwibrnjmf5yAtfcKB7rfsWO5/rLCVxxmY8NUHW91G84YK7h3aU5Fz92CnXFjWJkEqsztSV7tIa63Y0+rz98CGylHoSJOoD3/wK/8aCZhjqxbqOf3BA+Rphgozht6qjtkd4jQSDd4N21anvVjWJEkMgMJEKgdb+KV9wooqRHiJiDtEBm+gnNLhRxy3pDle1nsktrqNMz1QpmxlmluJWGSwmQadioR32ovrOZ97SqI3HF6JO/D2pgHrkza4DlrmKMALkhiTviaDMAckMSd8TRZgB5hv0DOpD8QI6SuMms6gOZhg+rtEcBhbyk7W/ipYsC2YZdJ0p9kkJp3GjhwkCJIcETKaNxo4ULA2WG2+QnuhTEjZUtDpQa3l1Wm6RjZYsDRYYZT5XKjxspYgAKDNW38fMG2Gct0Cb5iVtlccMlLECm4eETCj2Y9bNPMqNlgDzDtJ30nJ99kgktBJAbtvO+tM+JswRQbvifGvlByXyWAnINt3Zs7a6r5Acl81kKyDRU93lvzNNNw5/IZvzsk8xnKSDPUH8T3XWOo8/3LfzZJ5nOYkCeof1d7MXsrVAgbjKdxYA8QzOzbIq/8DjyfVAym+WAPEMrUOI39pHf7/1xk9ksB+QZWoGODLCENCtv3GQyCwJ5hmkCuck5twclk1kQyDNMFKg1Py5mCpTMZUkgzzAtR1Fh063yT1CgDGxxlSdQdoRFAHLDHneXz74IFMXuOvzF46G7ggBLAOSGpe6IA1AB5IaF7oj9kwHkhoXuiP2TAeSGZe6I3dMB5IZl7ojd0wHkhkXuiL0TAuSGRe6IvRMC5IZF7oi9EwLkhnEv/i/MaJxXAcgNS9wRO6cEyA0L3BH7JgXIDQvcEfsmBcgN890Ru6YFyA3z3RG7pgXIDbPdEXsmBsgNs90ReyYGyA3bzASqHMcMALlhm5lAleOYASA3bPPSX3L8cgDkhm1eAlWOXw6A3LDN6kE5blkAcsM2K4Eqxy0LQG5okJRAJea+ywhAbpjuTs6duxGA3DDuZfR9kKB7vyMAueGA2BkxeOICbYCru9/fRjeKT1kglaO30b0ntsw/Bn1qLfPqhA/1CL/4RvER6FPzw+ruf620B7AVAOSGClvXb8IbxUeDKgKZA2LMWV6FTsNF/CUU5rOdhov4SyjMZzsNF/GXUJjPdhou4i+hMJ/tNFzEX0JhPttpuIi/hMJ8ttNwEX8Jhflsp+Ei/hIK89lOw0X8JRTmTw/gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB3gJiAd4CYgHeAmIB2o4PPud/5fFfVRcv7fi7axZ8L4D10ZspUOCVz6Cxr7k0/OaZHIsE3Ew8r/s+vuutNg62WufnBrQgo18ApkfuL1VjhX2QOhczbCJV4gxzgJTShL2D6WwlM4eu7JIbqe4hUo+AAQ85w0XxyNYIEfyDFOQYOr6LNLgh0lJND2/HuvQNtQRwh3LV16mXeKFLKs0xAVKPhciq1fua65/jlo8yIwozWn/1qFz6rLfS4GsqzTEBMolN4YOn5PjRevQPYxIJ5K+tjV8IDNPIYMeeZJiAjUhI+R2137dFBpJJGjw3yhTFcMkAiO8BCQZ56EsEDh9NjWz13PJxGBfCf1mFk4cIZP6jltPZBnnoSgQNvoMXvexh7ZufgmZBPeP1Vnj7BFBdqG2mmkCerqfdfDdUwCpd9b7AF8fiDTPgWBlkYWWCWB2b6ESj1X9UP1fHW2YW/ZU9CSAtnh4qW4iX0ACMwb4TpN+CNN9pH9yLR/cgA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpADcB6QA3AekANwHpQFGtaRbJ7jqeMpGUUrGNPeE1gibge3JIlvvnCJOHbw7zBlBCak+gYDqlRYpA+Yk7rl5KPkuiQDqBeA8oYTVtzlGOaQLlJu7k1EsVyDMWUMLKngtsx4TKdnlYfbdSySiaSffn7lL9f6VS3tcdrW8v7QDamsSUh2/eumRqk6qiDPUF56g37dNcbB13WdXAWv3V7/pBPffoWJy8Pbl5WH27z6QZMzHOWt/JWuUC9fliG/0YZJVFr5g4gXRWvWqQCq8fjHhl8ivVC5Oianiude67e4+do95Uu1f/mDrusu4LXeVgPV2gcn4bKFqmZGAyxO28Ome+BKtigfpTqHRv0n+6OINAVzalrLtoUss6peyJ3e5F67LiG6tsO3bkTNXEqVowxFGXXZJWuN5qbUfURnnfYzKKezXO+Docg6UCvejXHKeJ/jMItLbRNK21YWPeH6fjQGh0xTnoTdXFph+9Iw+mUcF66oJpeDPu2JbJNO5wd8nhWlEq0MmPLotUx4oLpE27v/3dNnsCuYrjhvbprd2ccvqPSydQf1nfOrQ+FGgcYnsgkGOyF9c6oxRoyH/P7kHt8L4f60Ht4GTcgxw246G5Vy+nBzlntAK54WrnBifQ1aDJIJAe+ee3PZv+hWcOWk96lGlkM1ogJzQOhJ2EsPcXjQWyTA7iumM0yeagq+G2ELOKGQbqfgL1mNE9gfQZ1Gt7l8BmTOtwFbMyOFPTeeDOQneXdU9xk6yv3t4qNlpczXI1juucka5iw51pZh9k+an7AL87GGJmF9KaTYozdwqNti3jAWtNzc2Ig6jucmMzijduH7RXr98Hnf7dLGlGoJ7JJK5zRrYP2lOrbBO8FKJ3Z03haQoIGBz7LMYGu8Cmf8oj+yw2xbFP83xo8m7hpfs0/4QAbgLSAW4C0gFuAtIBbgLSAW4C0gFuAtIBbgLSAW4C0gFuAtIBbgLSAW4C0gFuAtIBbgLSAW4C0gFuAtIBbgLSAW4C0gFuAtIBbgLSAW4C0vF/PoWSPUIn76QAAAAASUVORK5CYII=" /><!-- --></p>
</div>
<div id="preprocessings-and-transformations" class="section level1">
<h1>Preprocessings and transformations</h1>
<p>Sometimes, the forecast accuracy of a model can be improved by
applying some transformations and/or preprocessings to the time series
being forecast. Currently, the <strong>utsf</strong> package is focused
on preprocessings related to forecasting time series with a trend. This
is due to the fact that, at present, the models incorporated in the
<code>forecast()</code> function (such as regression trees and k-nearest
neighbors) predict averages of the targets in the training set (i.e., an
average of historical values of the series). In a trended series these
averages are probably outside the range of the future values of the
series. Let us see an example in which a trended series (the yearly
revenue passenger miles flown by commercial airlines in the United
States) is forecast using a random forest model:</p>
<div class="sourceCode" id="cb23"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb23-1"><a href="#cb23-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(airmiles, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="cn">NULL</span>)</span>
<span id="cb23-2"><a href="#cb23-2" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>In this case, no preprocessing is applied
(<code>preProcess = NULL</code>). It can be observed how the forecast
does not capture the trending behavior of the series because regression
tree models predict averaged values of the training targets.</p>
<p>In the next subsections we explain how to deal with trended series
using three different transformations.</p>
<div id="differencing" class="section level2">
<h2>Differencing</h2>
<p>A common way of dealing with trended series is to transform the
original series taking first differences (computing the differences
between consecutive observations). Then, the model is trained with the
differenced series and the forecast are back-tranformed. Let us see an
example:</p>
<div class="sourceCode" id="cb24"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb24-1"><a href="#cb24-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(airmiles, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="fu">differences</span>(<span class="dv">1</span>)))</span>
<span id="cb24-2"><a href="#cb24-2" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>In this case, the <code>preProcess</code> parameter has been used to
specify first-order differences. The <code>preProcess</code> parameter
consists of a list of preprocessings or transformations. Currently, only
one preprocessing can be specified. The differences are specified using
the <code>differences()</code> function. This function takes one
parameter with the order of first differences (normally 1). It is also
possible to specify the value -1, in which case the order of differences
is estimated using the <code>ndiffs()</code> function from the
<strong>forecast</strong> package (in that case the chosen order of
first differences could be 0, that is, no differences are applied).</p>
<div class="sourceCode" id="cb25"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb25-1"><a href="#cb25-1" tabindex="-1"></a><span class="co"># The order of first differences is estimated using the ndiffs function</span></span>
<span id="cb25-2"><a href="#cb25-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(airmiles, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="fu">differences</span>(<span class="sc">-</span><span class="dv">1</span>)))</span>
<span id="cb25-3"><a href="#cb25-3" tabindex="-1"></a><span class="co">#&gt; Registered S3 method overwritten by &#39;quantmod&#39;:</span></span>
<span id="cb25-4"><a href="#cb25-4" tabindex="-1"></a><span class="co">#&gt;   method            from</span></span>
<span id="cb25-5"><a href="#cb25-5" tabindex="-1"></a><span class="co">#&gt;   as.zoo.data.frame zoo</span></span></code></pre></div>
<div class="sourceCode" id="cb26"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb26-1"><a href="#cb26-1" tabindex="-1"></a>f<span class="sc">$</span>differences</span>
<span id="cb26-2"><a href="#cb26-2" tabindex="-1"></a><span class="co">#&gt; Order of first differences (selected automatically): 2</span></span></code></pre></div>
</div>
<div id="the-additive-transformation" class="section level2">
<h2>The additive transformation</h2>
<p>This transformation has been used to deal with trending series in
other packages, such as <strong>tsknn</strong> and
<strong>tsfgrnn</strong>. The additive transformation works transforming
the training examples as follows:</p>
<ul>
<li>A vector of features is transformed by subtracting the mean of the
vector.</li>
<li>The target associated with a vector of features is transformed by
subtracting from it the mean of its associated vector of features.</li>
<li>To back transform a prediction, the mean of the input vector is
added to it.</li>
</ul>
<p>It is easy to check how the training examples are modified by the
additive transformation using the API of the package. For example, let
us see the training examples of a model with no transformation:</p>
<div class="sourceCode" id="cb27"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb27-1"><a href="#cb27-1" tabindex="-1"></a>timeS <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb27-2"><a href="#cb27-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(timeS, <span class="at">h =</span> <span class="dv">1</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">preProcess =</span> <span class="cn">NULL</span>)</span>
<span id="cb27-3"><a href="#cb27-3" tabindex="-1"></a><span class="fu">cbind</span>(f<span class="sc">$</span>features, <span class="at">Targets =</span> f<span class="sc">$</span>targets)</span>
<span id="cb27-4"><a href="#cb27-4" tabindex="-1"></a><span class="co">#&gt;   Lag2 Lag1 Targets</span></span>
<span id="cb27-5"><a href="#cb27-5" tabindex="-1"></a><span class="co">#&gt; 1    1    3       7</span></span>
<span id="cb27-6"><a href="#cb27-6" tabindex="-1"></a><span class="co">#&gt; 2    3    7       9</span></span>
<span id="cb27-7"><a href="#cb27-7" tabindex="-1"></a><span class="co">#&gt; 3    7    9      10</span></span>
<span id="cb27-8"><a href="#cb27-8" tabindex="-1"></a><span class="co">#&gt; 4    9   10      12</span></span></code></pre></div>
<p>Now, let us see the effect of the additive transformation in the
training examples:</p>
<div class="sourceCode" id="cb28"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb28-1"><a href="#cb28-1" tabindex="-1"></a>timeS <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="fu">c</span>(<span class="dv">1</span>, <span class="dv">3</span>, <span class="dv">7</span>, <span class="dv">9</span>, <span class="dv">10</span>, <span class="dv">12</span>))</span>
<span id="cb28-2"><a href="#cb28-2" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(timeS, <span class="at">h =</span> <span class="dv">1</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">2</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="st">&quot;additive&quot;</span>))</span>
<span id="cb28-3"><a href="#cb28-3" tabindex="-1"></a><span class="fu">cbind</span>(f<span class="sc">$</span>features, <span class="at">Targets =</span> f<span class="sc">$</span>targets)</span>
<span id="cb28-4"><a href="#cb28-4" tabindex="-1"></a><span class="co">#&gt;   Lag2 Lag1 Targets</span></span>
<span id="cb28-5"><a href="#cb28-5" tabindex="-1"></a><span class="co">#&gt; 1 -1.0  1.0     5.0</span></span>
<span id="cb28-6"><a href="#cb28-6" tabindex="-1"></a><span class="co">#&gt; 2 -2.0  2.0     4.0</span></span>
<span id="cb28-7"><a href="#cb28-7" tabindex="-1"></a><span class="co">#&gt; 3 -1.0  1.0     2.0</span></span>
<span id="cb28-8"><a href="#cb28-8" tabindex="-1"></a><span class="co">#&gt; 4 -0.5  0.5     2.5</span></span></code></pre></div>
<p>Finally, we forecast the airmiles series using the additive
tranformation and a random forest model:</p>
<div class="sourceCode" id="cb29"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb29-1"><a href="#cb29-1" tabindex="-1"></a>f <span class="ot">&lt;-</span> <span class="fu">forecast</span>(airmiles, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">4</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="st">&quot;additive&quot;</span>))</span>
<span id="cb29-2"><a href="#cb29-2" tabindex="-1"></a><span class="fu">autoplot</span>(f)</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,iVBORw0KGgoAAAANSUhEUgAAASAAAAEgCAMAAAAjXV6yAAABDlBMVEUAAAAAADoAAGYAOmYAOpAAZrYzMzM6AAA6ADo6AGY6OmY6OpA6kNtNTU1NTVNNTVlNTW5NTY5NbqtNjshjTY5mAABmADpmAGZmOgBmtv9pTVluTU1uTW5uTXluTY5ubo5ubqtunZ1uq8huq+R5TU15TW5/tauOTU2OTW6OTY6Obk2ObquOoo6OyKuOyP+QOgCQOjqQkDqQtpCQ2/+rY02rbk2rbm6rbo6rjk2ryKurzaur5Mir5OSr5P+1q261//+2ZgC225C2///IeU3Ijk3I5KvI/8jI/+TI///MAADbkDrb/7bb///kq27k5Kvk///r6+v/tmb/yI7/25D/5Kv//7b//8j//9v//+T////5/UeyAAAACXBIWXMAAA7DAAAOwwHHb6hkAAAKA0lEQVR4nO2dbXvbNBSGvdKuHdTQbWyjdJRBgfGaAqWDDQqlFNaElSVN1kb//48gyfKLHNtHsS1bjp/nQywfy451XzqS42OfeAwqlNf2CbguACIEQIQAiBAAEQIgQksDGitFhRKlUjvbaL2BAIgQABECIEIARAiACAEQIQAiBECEOgBoOASgotJwKAgBEADBxawBGgMQAAGQPUDDMQABUAVAw7Bko/UGAiBCjgOSF4kAlFsaAhAAVXWxyGaj9QZyHVBss9F6AzkeWR22fQKO96Bhwmaj9QYCIEIARMhpQMOkzUbrDeQwIH4NBEAFpSEAAVAlQOJmPQAVAhoDEABVGYPGAARAFQAN0zYbrTeQo4DUjTIAyikNAQiAKgEaD4cLNhutN5CjgDJKNlpvIAAiBECEAIgQABECIEIOAvI8ACra7HkxIZcAXfn+3QvGrp/6917nLHoNaLZ/wS7vs/nxIHfRECCHXYxDuv7qIncRVGoAkLODNO8lsyev2fWXJ5kLXuP27duNnpEDik9ntrdzwq7uSRaZi6Ca9R7kuTvN53WduAcx24DkAO0sIHY+aHkM8twFpNxofnwQzFsZi34DYpe+z8egtq+D5BTvJiBT2QU0BqDizV7+VhutNxAAEQIgQgBECIAIARAhtwB5BVtttN5AAEQIgAgBECEAIgRAhJwC5BVttdF6AwEQIQAiBECEAIgQABFyBJDnjVkUcgagBaOnBEAAVA7QKrmYJblyHgtypQfRO9tovYEAiBAAEeo+oBGf/W4dpYzTrbSlrNwAlB+RJwGN1s4Ym3i71TDkq+uAbg53xeJ0/VUlDPnqPqDtuOh5vDtN7/zgrf3JXUyts+kmd8LdvgLi3uVtKz4b3OHWX003N+QYFK2L4Wi6WZaQE4AK4qkkoGCU5iwmore8ebArWXAq0fqds5JsVgUQExzWX42Cn3PbQY/ZOgrX2ank129AEogapyNA8bj95oEcjEqp64DUBY9wKXUxFAKaJC+OuKstz0bKAUBeUTSMAsROBQcxIN8c8i7DqYSAwnU5FpW/cGwfUHgfqMqVtJzIxLTOaYWAwnUxzy1eavcIkGW1D6iii9mWC4DMdrbRegMBECEAIgRAhNoHVBzLACAAsgtonK2qWGIBEKHWAWUmEXAR0GzP9wctvHHYFUDirebZ45PmMy90BdCVAND8W885eTocBCREvzdfd+YF8Uu+2hGaBCTe/m4480Jephcne9D10wNG5e6oG1BephcXAc32BoJS05kX7AIKQj78M4796FGgdExoMUYU5Q+SfLJTLljMvJCTCqcMoERnXARUhMAM0KUvNGj6Oqg+QMnhLLsHTUQkWkaAgjDQ9O0P1v7kdr4mbmVvivh0PiBjOQfIW1A2oDePzthoQ5pOt9lExKglEPH4w2T934dHuiuuDqDoUFkutimJrUlAD48UM4GKrwkYGhNudw1QXjKlMoA0hYCSLsZp3Yq6yc33EaB3ggjsqQLZX0BcwrGye5AIvTroYk0CmohAqwQUjkEBIDEGTe+I0Xq6ddRnQIEPsZvDaBYLAKlZbOR5b32Q8azMagOqQa0CMni2FYAACIAAKPOMqgMqyHgHQOPinIkABEA0ILgYCWi5nYtPB4AACIDSg/SSOxefDgD1DpDhg3fVAAW3XLezd00rO96xOoCG8X+vj/X7QYZyChCRhqIEoPBf/zIBxXEedbNMi/UkAkI1AKpF1R9aCBWQ0bUIKI7ziOJog2mxnkRAKONUlz+jGnoQlcikRA/KdrFN+TZi4i69CP5o4R2+EgeEnAFEJTIpA0hTCChocyLOwx1JvPujxXrigJBDgJbfuQKgZA96dBZvULEeYVBRjp4CSsR5VFGL9SQCQn0FFMd51PSlxXoSASFXAJk/FVQNUA0CIEIARAiACLUCaImnggCoIiDragGQ+B0GQPklD4AAqBIgmXUTgIoAldvZRusNBECEAIhQC4N0yZ1ttN5AAESocUBLBpwBCIC0kmG2qd4CMk3HBUCdBCRfS7X8xqFhvjInAV35dy+yUy7UmHlh6XiqO4DOd57zHmT7recOAwpczHbmBWf/HSJXKUCWMy8sH5HvWA9ivQdkeQzqPiC7mRdKRORdA2T3OqjjgMwEQIQqtLFMwBmAACgseEskU+ojIA+AAEiqdBu1/EcAlAEotgFQlouNAQiAhEq2UYs3A1C6lHpFHoBSpXQOAQACINORxwtdbAxA6RKHIh9HFMvUVgAaMy1BZnorAClAYS8CoKxSGGXOePsSgCSg/K0ABEAAlCsAcv3ADcveNF+wdaV7EAARAiBChu0pjDIDEAABUK6M2kP8p1HvAVF/+gRAAES6WGFrAYh477v3gKj3vgEIgAraY5BovNeATDKxAxAA5f3A8NRFNAAttiInBgZAoqTgABDLBhTCMU3R2i9AoWstkRaoV4CSngVALAVIG5gBSGqswLB4YF66tSsPSH/2Z/nWrhyg9BuHEZwl/79oVQEtZl5QLla2tasGyOb/za8EoBozL3RPJoDqy7yw8j2IAVCWMAYRqi3zwqoCqjED1YoCSgqACAHQ0sq6NDK1Vdu5CQEQIQAiBECEVuV5b2sCIEIARAiACAEQobKA5K/72Z5IkMuCm7LqF5tuu/R9vqpswYqot/NHtLMyahXnx/7OSeqAyqaqN6eSgK6Clg7YpfwVe+kP2Pwn/+7v93Ub+ytZ73wgdp0ff+u/dz9lXKh4de+1fsDAFlZvTuUABamDoxtps4+/HrDz977b/3v/b9327hdxvfkzec/t+rOd54/fv9CNWkVx/0nYkgdUNlW9QVVxsRDQ/Nlv3J1mT/7b/+fLF5qNO4nvD8J2yxWx1+yjz090o1Zx9uQX4U7aAZVNVW9QVQDJ3s/P+vJAjDdX90R7ftVss8cv9l8+U7bZY8FN5BYWgK41o15xT2LUDqhsqnqtCIpVdZD+9JnoC/OoB51oNlnvfBDY5H7nA9WDmGbUKkYdST9gdF+80XGoEiAm71eLicX3D66/4gOGtMY21e7AJuufD3hpxscgphm1itffqGEncUBli6o3pkouxk84uFctesv8+JN9PuloNuElL3/+J7CJSWj+88X8+GD24f1wZ2XUKgoCsgsmD3iu3E5Wr635tCr1oCtf3atOXAfpNt6T+ICkbMFKeB2kG7WKvMbdi9QBlU1Vb064kiYEQIQAiBAAEQIgQgBEyCagm0P1qN7GdOvI4vdYle0e1GE0gQCIUDOA+Od068dNz9ue8o/dwPvWzix/dy1qDtDm+is28sTH2tnN4QZjI152Xw0C2uVL+bF1NBG9582DXctfXocadLEjtcY/RsHstm35y+tQS4A64V1S7QCa3OrM3NYOoJtD3oW6QakdQHKa7wQf/BajBECEAIgQABECIEIARAiACAEQIQAiBECE/geLvvOi8SfMqQAAAABJRU5ErkJggg==" /><!-- --></p>
</div>
<div id="the-multiplicative-transformation" class="section level2">
<h2>The multiplicative transformation</h2>
<p>The multiplicative transformation is similar to the additive
transformation, but it is intended for series with an exponential trend
(the additive transformation is suited for series with a linear trend).
In the multiplicative transformation a training example is transformed
this way:</p>
<ul>
<li>A vector of features is transformed by dividing it by its mean.</li>
<li>The target associated with a vector of features is transformed by
dividing it by the mean of its associated vector of features.</li>
<li>To back transform a prediction, the prediction is multiplied by the
mean of the input vector.</li>
</ul>
<p>Let us see an example of an artificial time series with a
multiplicative trend and its forecast using the additive and the
multiplicative transformation:</p>
<div class="sourceCode" id="cb30"><pre class="sourceCode r"><code class="sourceCode r"><span id="cb30-1"><a href="#cb30-1" tabindex="-1"></a>t <span class="ot">&lt;-</span> <span class="fu">ts</span>(<span class="dv">10</span> <span class="sc">*</span> <span class="fl">1.05</span><span class="sc">^</span>(<span class="dv">1</span><span class="sc">:</span><span class="dv">20</span>))</span>
<span id="cb30-2"><a href="#cb30-2" tabindex="-1"></a>f_m <span class="ot">&lt;-</span> <span class="fu">forecast</span>(t, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="st">&quot;multiplicative&quot;</span>))</span>
<span id="cb30-3"><a href="#cb30-3" tabindex="-1"></a>f_a <span class="ot">&lt;-</span> <span class="fu">forecast</span>(t, <span class="at">h =</span> <span class="dv">4</span>, <span class="at">lags =</span> <span class="dv">1</span><span class="sc">:</span><span class="dv">3</span>, <span class="at">method =</span> <span class="st">&quot;rf&quot;</span>, <span class="at">preProcess =</span> <span class="fu">list</span>(<span class="st">&quot;additive&quot;</span>))</span>
<span id="cb30-4"><a href="#cb30-4" tabindex="-1"></a><span class="fu">library</span>(vctsfr)</span>
<span id="cb30-5"><a href="#cb30-5" tabindex="-1"></a><span class="fu">plot_predictions</span>(t, <span class="at">predictions =</span> <span class="fu">list</span>(<span class="at">Multiplicative =</span> f_m<span class="sc">$</span>pred, <span class="at">Additive =</span> f_a<span class="sc">$</span>pred))</span></code></pre></div>
<p><img role="img" src="data:image/png;base64,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" /><!-- --></p>
<p>In this case, the forecast with the multiplicative transformation
captures perfectly the exponential trend.</p>
</div>
</div>
<div id="default-parameters" class="section level1">
<h1>Default parameters</h1>
<p>The <code>forecast()</code> function only has two compulsory
parameters: the time series being forecast and the forecast horizon.
Next, we discuss the default values for the rest of its parameters:</p>
<ul>
<li><code>lags</code>: The <code>lags</code> parameter is an integer
vector (in increasing order) with the autoregressive lags. If
<code>frequency(ts) == f</code> where <code>ts</code> is the time series
being forecast and <span class="math inline">\(f &gt; 1\)</span> then
the lags used as autoregressive features are 1:<em>f</em>. For example,
the lags for quarterly data are 1:4 and for monthly data 1:12. This is
useful to capture a possible seasonal behavior of the series. If
<code>frequency(ts) == 1</code>, then:
<ul>
<li>The lags with significant autocorrelation in the partial
autocorrelation function (<code>stats::pacf()</code>) are selected.</li>
<li>If no lag has a significant autocorrelation, then lags 1:5 are
chosen.</li>
<li>If only one lag has significant autocorrelation and the additive or
multiplicative transformation is applied, then lags 1:5 are chosen. This
is done because it does not make sense to use these transformations with
only one autoregressive lag.</li>
</ul></li>
<li><code>method</code>: By default, the k-nearest neighbors algorithm
is applied.</li>
<li><code>param</code>: By default, the model is trained using some
sensible parameters, normally the default values of the function used to
train the model.</li>
<li><code>preProcess</code>: The additive transformation is applied.
This transformation have proved its effectiveness to forecast trending
series. In general, its application seems beneficial on any kind of
series.</li>
<li><code>efa</code>: No estimation of forecast accuracy is done.</li>
<li><code>tuneGrid</code>: No estimation of forecast accuracy is
done.</li>
</ul>
</div>



<!-- code folding -->


<!-- dynamically load mathjax for compatibility with self-contained -->
<script>
  (function () {
    var script = document.createElement("script");
    script.type = "text/javascript";
    script.src  = "https://mathjax.rstudio.com/latest/MathJax.js?config=TeX-AMS-MML_HTMLorMML";
    document.getElementsByTagName("head")[0].appendChild(script);
  })();
</script>

</body>
</html>
